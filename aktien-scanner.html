<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aktien Scanner</title>
  <script src="https://unpkg.com/feather-icons"></script>
  <style>
    body { background: #121212; color: #e0e0e0; font-family: Arial; margin: 0; padding: 20px; }
    #navMenu { position: fixed; top: 0; left: 0; width: 100%; height: 70px; background: rgba(53,53,53,0.95); box-shadow: 0 4px 20px rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 1100; }
    #navMenu .menu-item { margin: 0 15px; font-size: 16px; display: flex; align-items: center; gap: 5px; }
    #navMenu .menu-item a { color: #e0e0e0; text-decoration: none; padding: 5px 10px; border-radius: 5px; transition: all 0.3s ease; display: flex; align-items: center; gap: 6px; }
    #navMenu .menu-item a.active { background-color: #2e7d32; color: #fff!important; font-weight: bold; box-shadow: 0 0 10px #2e7d32; }
    .filter-buttons { text-align: center; margin-top: 90px; margin-bottom: 20px; }
    .filter-buttons button { background: #333; color: #e0e0e0; border: none; padding: 8px 16px; margin: 5px; border-radius: 5px; cursor: pointer; }
    .filter-buttons button.active { background: #2e7d32; }
    .content { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
    .tile { background: rgba(105,93,79,0.9); border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.3); position: relative; }
    .tile.green { border: 2px solid #2e7d32; }
    .tile.blue { border: 2px solid #2962ff; }
    .tile h3 { margin: 0 0 10px 0; }
    .tile .status { position: absolute; top: 10px; right: 10px; font-size: 12px; background: #2e7d32; color: white; padding: 4px 8px; border-radius: 5px; }
    .tile.blue .status { background: #2962ff; }
    .tile .kurs { margin-bottom: 6px; }
    .tile .change { color: lightgreen; }
    .tile .change.neg { color: #ff5252; }
    #lastUpdate { text-align: center; font-size: 14px; margin-top: 10px; color: #bbb; }
    #loadButton { background: #0066cc; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; display: block; margin: 20px auto; }
  </style>
</head>
<body>
  <nav id="navMenu">
    <div class="menu-item"><a href="index.html"><i data-feather="home"></i> Home</a></div>
    <div class="menu-item"><a href="verwaltung.html"><i data-feather="folder"></i> Verwaltung</a></div>
    <div class="menu-item"><a href="scanner.html" class="active"><i data-feather="search"></i> Scanner</a></div>
  </nav>

  <div class="filter-buttons">
    <button onclick="setFilter('all')" class="active">Alle</button>
    <button onclick="setFilter('besitz')">Besitz</button>
    <button onclick="setFilter('beobachtung')">Beobachtung</button>
    <button id="loadButton">Daten abrufen</button>
  </div>

  <div id="scannerContent" class="content"></div>
  <div id="lastUpdate"></div>

  <script>
    feather.replace();

    let filter = 'all';
    let daten = [];

    async function ladeDaten() {
      document.getElementById('scannerContent').innerHTML = '<p>Wird geladen...</p>';
      const apiKey = 'DEIN_API_KEY'; // <-- hier deinen API-Key einsetzen

      const beobachtenListe = [
        { symbol: 'AAPL', name: 'Apple', besitz: true },
        { symbol: 'MSFT', name: 'Microsoft', besitz: true },
        { symbol: 'GOOGL', name: 'Alphabet', besitz: false },
        { symbol: 'AMZN', name: 'Amazon', besitz: false },
        { symbol: 'TSLA', name: 'Tesla', besitz: false }
      ];

      daten = await Promise.all(beobachtenListe.map(async aktie => {
        try {
          const url = `https://api.twelvedata.com/quote?symbol=${aktie.symbol}&apikey=${apiKey}`;
          const res = await fetch(url);
          const json = await res.json();
          if (json.status === 'error') throw new Error('Fehlerhafte Daten');

          return {
            name: aktie.name,
            symbol: aktie.symbol,
            besitz: aktie.besitz,
            kurs: parseFloat(json.price),
            veraenderung: parseFloat(json.percent_change)
          };
        } catch (e) {
          console.error('Fehler bei', aktie.symbol, e);
          return null;
        }
      }));

      daten = daten.filter(d => d !== null);

      render();
      document.getElementById('lastUpdate').textContent = 'Letzte Aktualisierung: ' + new Date().toLocaleTimeString();
    }

    function setFilter(neu) {
      filter = neu;
      document.querySelectorAll('.filter-buttons button').forEach(btn => btn.classList.remove('active'));
      document.querySelector(`.filter-buttons button[onclick*="${neu}"]`).classList.add('active');
      render();
    }

    function render() {
      const container = document.getElementById('scannerContent');
      if (daten.length === 0) {
        container.innerHTML = '<p>Keine Daten verfügbar.</p>';
        return;
      }

      container.innerHTML = daten
        .filter(d => filter === 'all' || (filter === 'besitz' && d.besitz) || (filter === 'beobachtung' && !d.besitz))
        .map(d => `
          <div class="tile ${d.besitz ? 'green' : 'blue'}">
            <div class="status">${d.besitz ? 'Besitz' : 'Beobachtung'}</div>
            <h3>${d.name}</h3>
            <div class="kurs">Kurs: ${d.kurs.toFixed(2)} USD</div>
            <div class="change ${d.veraenderung < 0 ? 'neg' : ''}">Veränderung: ${d.veraenderung.toFixed(2)}%</div>
          </div>
        `)
        .join('');
    }

    document.getElementById('loadButton').addEventListener('click', ladeDaten);
    window.onload = () => render();
  </script>
</body>
</html>